<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RapidReach ‚Äì Social Growth</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{background:#f6f8fc;color:#0f172a}

/* HERO */
.hero{min-height:100vh;text-align:center;padding:120px 20px;background:radial-gradient(circle at top,#e0ebff,#f6f8fc)}
.badge{display:inline-block;padding:8px 18px;border-radius:999px;background:#eaf0ff;color:#2563eb;font-size:14px;margin-bottom:25px}
.hero h1{font-size:56px;font-weight:800;line-height:1.15}
.hero h1 span{color:#2563eb}
.hero p{margin-top:20px;font-size:18px;color:#475569}
.hero-buttons{margin-top:45px;display:flex;justify-content:center;gap:20px;flex-wrap:wrap}
.btn{padding:16px 30px;border-radius:18px;border:none;font-size:16px;font-weight:600;cursor:pointer;transition:.3s}
.btn:hover{transform:translateY(-4px)}
.primary{background:linear-gradient(135deg,#2563eb,#1e40af);color:#fff}
.secondary{background:linear-gradient(135deg,#7c3aed,#5b21b6);color:#fff}
.premium{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff}

/* POPUP */
.popup-overlay{position:fixed;inset:0;background:rgba(15,23,42,.55);backdrop-filter:blur(12px);display:none;align-items:center;justify-content:center;z-index:999}
.popup{background:#f8fbff;padding:40px;border-radius:32px;width:90%;max-width:520px;text-align:center;box-shadow:0 40px 90px rgba(0,0,0,.25);display:none}
.popup h2{font-size:26px;margin-bottom:20px}

.service-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px;margin-bottom:25px}
.service-card{padding:16px;border-radius:18px;background:#fff;font-weight:600;cursor:pointer;box-shadow:0 10px 25px rgba(0,0,0,.08);transition:.25s}
.service-card:hover,.service-card.active{background:#2563eb;color:#fff;transform:translateY(-4px)}

.order-box{display:none}
.order-box input{
  width:100%;
  padding:16px;
  border-radius:18px;
  border:2px solid #0f172a;
  font-size:16px;
  margin-top:10px;
}

.min-text{
  margin-top:12px;
  font-size:14px;
  color:#64748b;
}

.pay-label{
  margin-top:18px;
  font-size:14px;
  color:#64748b;
  display:none;
}

.price{
  margin-top:6px;
  font-size:22px;
  font-weight:800;
  display:none;
}

/* üîΩ ADDED (NEXT STEP UI) üîΩ */
.next-step{
  margin-top:22px;
  display:none;
}
.next-step .step-title{
  margin-top:10px;
  font-size:14px;
  color:#64748b;
}
.next-step .pay-options{
  display:flex;
  gap:14px;
  justify-content:center;
  margin-top:14px;
}

/* üîΩ ADDED (DISABLED BUTTON STYLE) üîΩ */
button:disabled{
  opacity:0.5;
  cursor:not-allowed;
  transform:none !important;
}

.close-btn{margin-top:28px;padding:14px 38px;border-radius:16px;border:none;background:#0f172a;color:#fff;cursor:pointer}
</style>
</head>

<body>

<section class="hero">
  <div class="badge">üéÅ 100% Free ‚Äì No card required</div>
  <h1>Get & Earn <span>Followers</span> and <span>Views</span><br>For Free</h1>
  <p>Boost your social media presence with our free services !!</p>

  <div class="hero-buttons">
    <button class="btn primary" onclick="openPopup('tiktok')">üéµ TikTok</button>
    <button class="btn secondary" onclick="openPopup('instagram')">üì∏ Instagram</button>
    <button class="btn premium" onclick="openPopup('youtube')">‚ñ∂ YouTube</button>
  </div>
</section>

<!-- POPUP -->
<div class="popup-overlay" id="overlay">
  <div class="popup" id="popup">
    <h2 id="popupTitle"></h2>

    <div class="service-grid" id="services"></div>

    <div class="order-box" id="orderBox">
      <input type="number" id="qty" placeholder="Enter quantity">

      <div class="min-text" id="minText"></div>

      <div class="pay-label" id="payLabel">Amount to be paid</div>
      <div class="price" id="price"></div>

      <!-- üîΩ ADDED NEXT STEP üîΩ -->
      <div class="next-step" id="nextStep">
        <div class="step-title">Service Details</div>

        <input type="text" id="contentLink" placeholder="Enter Reel / Video Link">

        <input type="text" id="profileLink"
               placeholder="Enter Profile Link (for followers/subscribers only)"
               style="display:none;">

        <div class="step-title">Choose Payment Method</div>

        <div class="pay-options">
          <!-- üîΩ ADDED disabled + ids üîΩ -->
          <button class="btn primary" id="cryptoBtn" disabled>ü™ô Crypto</button>
          <button class="btn secondary" id="inrBtn" disabled>üáÆüá≥ INR</button>
        </div>
      </div>
      <!-- üîº END ADDITION üîº -->
    </div>

    <button class="close-btn" onclick="closePopup()">Close</button>
  </div>
</div>

<script>
const RATE_INR = 100;

const DATA = {
  tiktok:{
    title:"üéµ TikTok Services",
    services:{
      Views:{price:0.2,min:100},
      Likes:{price:0.3,min:100},
      Followers:{price:1.1,min:50},
      Shares:{price:0.2,min:100},
      Comments:{price:1,min:50}
    }
  },
  instagram:{
    title:"üì∏ Instagram Services",
    services:{
      Views:{price:0.12,min:200},
      Likes:{price:0.25,min:50},
      Comments:{price:0.5,min:50},
      Followers:{price:0.8,min:100},
      Shares:{price:0.2,min:100},
      Reposts:{price:0.65,min:50}
    }
  },
  youtube:{
    title:"‚ñ∂ YouTube Services",
    services:{
      Subscribers:{price:25,min:500},
      Likes:{price:0.5,min:100},
      Views:{price:1,min:100}
    }
  }
};

let selectedService=null;
let selectedServiceName="";
let currentPlatform=""; // üîΩ ADDED

function openPopup(platform){
  currentPlatform = platform;
  overlay.style.display="flex";
  popup.style.display="block";
  popupTitle.innerText=DATA[platform].title;
  services.innerHTML="";
  orderBox.style.display="none";

  // ‚úÖ RESTORED: service buttons rendering
  Object.entries(DATA[platform].services).forEach(([name,info])=>{
    const div=document.createElement("div");
    div.className="service-card";
    div.innerText=name;
    div.onclick=()=>selectService(div,info,name);
    services.appendChild(div);
  });
}

function selectService(el,info,name){
  document.querySelectorAll(".service-card").forEach(c=>c.classList.remove("active"));
  el.classList.add("active");

  selectedService=info;
  selectedServiceName=name;

  orderBox.style.display="block";
  qty.value="";
  minText.innerText=`Min order: ${info.min}`;
  price.style.display="none";
  payLabel.style.display="none";
  nextStep.style.display="none";

  profileLink.style.display =
    (name==="Followers" || name==="Subscribers") ? "block" : "none";
}

qty.addEventListener("input",()=>{
  if(!selectedService) return;
  const q=Number(qty.value);
  if(q < selectedService.min){
    price.style.display="none";
    payLabel.style.display="none";
    nextStep.style.display="none";
    return;
  }
  const usd=(q/1000)*selectedService.price;
  const inr=usd*RATE_INR;
  payLabel.style.display="block";
  price.style.display="block";
  price.innerText=`$${usd.toFixed(2)} | ‚Çπ${inr.toFixed(0)}`;
  nextStep.style.display="block";
});

function closePopup(){
  overlay.style.display="none";
}

/* üîΩ ADDED PLATFORM-AWARE LINK VALIDATION üîΩ */
const contentLinkInput = document.getElementById("contentLink");
const cryptoBtn = document.getElementById("cryptoBtn");
const inrBtn = document.getElementById("inrBtn");

function isValidLinkForPlatform(link, platform){
  if(!link) return false;
  link = link.toLowerCase();

  if(platform === "tiktok") return link.includes("tiktok.com/");
  if(platform === "instagram") return link.includes("instagram.com/");
  if(platform === "youtube") return link.includes("youtube.com/") || link.includes("youtu.be/");

  return false;
}

contentLinkInput.addEventListener("input",()=>{
  const link = contentLinkInput.value.trim();

  if(isValidLinkForPlatform(link, currentPlatform)){
    cryptoBtn.disabled = false;
    inrBtn.disabled = false;
  } else {
    cryptoBtn.disabled = true;
    inrBtn.disabled = true;
  }
});

cryptoBtn.addEventListener("click", async () => {
  if (cryptoBtn.disabled) return;

  // Extra safety check
  const link = contentLinkInput.value.trim();
  if (!isValidLinkForPlatform(link, currentPlatform)) return;

  // Collect order data from existing state
  const qtyVal = Number(qty.value);
  const usdText = price.innerText.split("|")[0].replace("$","").trim();
  const usdPrice = Number(usdText);

  const orderPayload = {
    platform: currentPlatform,
    service: selectedServiceName,
    quantity: qtyVal,
    usdPrice: usdPrice,
    coin: "DOGE" // default for now (we‚Äôll add selector later)
  };

  cryptoBtn.innerText = "Processing...";
  cryptoBtn.disabled = true;

  try {
    const res = await fetch("/api/create-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(orderPayload)
    });

    const data = await res.json();
    if (!data.success) throw new Error("Order failed");

    // Open payment window
    const paymentWindow = window.open(
      "",
      "cryptoPayment",
      "width=480,height=620"
    );

    paymentWindow.document.write(`
      <html>
      <head>
        <title>Crypto Payment</title>
        <style>
          body{font-family:Inter,system-ui;padding:30px;background:#f6f8fc;color:#0f172a}
          .box{background:#fff;padding:25px;border-radius:18px;box-shadow:0 20px 50px rgba(0,0,0,.15)}
          h2{margin-bottom:10px}
          code{word-break:break-all}
          input{width:100%;padding:12px;border-radius:12px;border:1px solid #ccc;margin-top:10px}
          button{margin-top:15px;padding:12px 20px;border-radius:14px;border:none;background:#2563eb;color:#fff;font-weight:600;cursor:pointer}
        </style>
      </head>
      <body>
        <div class="box">
          <h2>ü™ô Crypto Payment</h2>
          <p><strong>Send EXACT amount:</strong></p>
          <h3>${data.order.cryptoAmount} ${data.order.coin}</h3>

          <p><strong>To address:</strong></p>
          <code>${data.order.walletAddress}</code>

          <p><strong>Order ID:</strong> ${data.order.orderId}</p>

          <p>Paste TXID after payment:</p>
          <input id="txid" placeholder="Transaction ID">

          <button onclick="
            fetch('/api/verify-payment',{
              method:'POST',
              headers:{'Content-Type':'application/json'},
              body:JSON.stringify({
                order:${JSON.stringify(data.order)},
                txid:document.getElementById('txid').value
              })
            }).then(r=>r.json()).then(d=>{
              if(d.success){
                window.opener.location.href=d.redirect;
                window.close();
              }else{
                alert('Payment not confirmed yet');
              }
            });
          ">Confirm Payment</button>
        </div>
      </body>
      </html>
    `);

  } catch (err) {
    alert("Failed to create order");
    cryptoBtn.disabled = false;
    cryptoBtn.innerText = "ü™ô Crypto";
  }
});


</script>

</body>
</html>
